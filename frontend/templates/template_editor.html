<!--
===============================================================================
Project   : gratulo
Module    : frontend/templates/template_editor.html
Created   : 2025-10-05
Author    : Florian
Purpose   : Provides WYSIWYG editor for templates (TinyMCE)
===============================================================================
-->

{% extends "base.html" %}

{% block title %}Template-Editor – {{ LABELS_DISPLAY.entity_singular }}-Mailer{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
  <h2 class="text-2xl font-bold text-gray-800 mb-6">Template-Editor</h2>

  <form id="template-form"
        hx-post="/htmx/templates/"
        hx-swap="none"
        class="space-y-4">

    <input type="hidden" name="id" value="{{ template.id if template else '' }}">

    <!-- Template name -->
    <div>
      <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
      <input type="text" name="name" id="name"
             value="{{ template.name if template else '' }}"
             class="w-full border rounded p-2" required>
    </div>

    <!-- Template content -->
    <div>
      <label for="editor" class="block text-sm font-medium text-gray-700">Inhalt</label>
      <textarea name="content_html" id="editor">{{ template.content_html if template else '' }}</textarea>
    </div>

    <!-- Action buttons -->
    <div class="flex gap-2 mt-4">
      <button type="submit" class="btn btn-blue">Speichern</button>
      <a href="/templates" class="btn btn-gray">Zurück</a>
    </div>

  </form>
</div>

<!-- TinyMCE lokal -->
<script src="{{ url_for('static', path='js/tinymce/tinymce.min.js') }}" defer nonce="{{ csp_nonce }}"></script>

<!-- CSP-konformer Label-Kontext -->
<script nonce="{{ csp_nonce }}">
    window.GRATULO_LABEL_DATE1 = {{ LABELS_DISPLAY.date1 | tojson }};
    window.GRATULO_LABEL_DATE1_TYPE = {{ LABELS_DISPLAY.date1_type | tojson }};
    window.GRATULO_LABEL_DATE2 = {{ LABELS_DISPLAY.date2 | tojson }};
    window.GRATULO_LABEL_DATE2_TYPE = {{ LABELS_DISPLAY.date2_type | tojson }};
    window.GRATULO_LABEL_ENTITY_SINGULAR = {{ LABELS_DISPLAY.entity_singular | tojson }};
</script>

<script src="{{ url_for('static', path='js/tinymce_init.js') }}" type="module" defer nonce="{{ csp_nonce }}"></script>
<script src="{{ url_for('static', path='js/template_editor.js') }}" defer nonce="{{ csp_nonce }}"></script>
{% endblock %}
