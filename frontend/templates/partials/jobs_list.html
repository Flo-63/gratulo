<!--
===============================================================================
Project   : gratulo
Module    : frontend/templates/partials/jobs_list.html
Created   : 2025-10-05
Author    : Florian
Purpose   : Dynamic template to show the list of jobs

@docstyle: google
@language: english
@voice: imperative
===============================================================================
-->


<div class="overflow-hidden bg-white shadow rounded-lg">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Name</th>
        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Betreff</th>
        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Selektion</th>
        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Gruppe</th>
        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Template</th>
        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Zeit</th>
        <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider">Aktionen</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-200 text-sm text-gray-700">
      {% for job in jobs %}
      <tr class="hover:bg-gray-50">
        <td class="px-6 py-4 font-medium text-gray-900">{{ job.name }}</td>
        <td class="px-6 py-4">{{ job.subject or "-" }}</td>
        <td class="px-6 py-4">
          {% if job.selection == "birthdate" %}
            <span class="inline-flex items-center gap-1 px-2 py-1 bg-pink-100 text-pink-800 text-xs font-medium rounded-full">Geburtstag</span>
          {% elif job.selection == "entry" %}
            <span class="inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">Eintritt</span>
          {% endif %}
        </td>
        <td class="px-6 py-4">
          {{ job.group_name if job.group_name else "-" }}
        </td>
        <td class="px-6 py-4">{{ job.template.name if job.template else "-" }}</td>
        <td class="px-6 py-4 text-gray-500">
          {% if job.cron_human %}
            {{ job.cron_human }}
          {% elif job.once_at %}
            {% if job.once_at_local is defined %}
              Einmalig am {{ job.once_at_local.strftime('%d.%m.%Y %H:%M') }}
            {% elif job.once_at %}
              Einmalig am {{ job.once_at.strftime('%d.%m.%Y %H:%M') }}
            {% else %}
              Einmalig – kein Datum gesetzt
            {% endif %}
          {% else %}-{% endif %}
        </td>
        <td class="px-6 py-4 text-right">
          <div class="flex justify-end gap-2">
            <button hx-get="/htmx/jobs/{{ job.id }}/logs"
                    hx-target="body"
                    hx-swap="beforeend"
                    class="inline-flex items-center px-3 py-1 rounded bg-teal-600 hover:bg-teal-700 text-white text-xs font-medium">
              Logs
            </button>
            <a href="/jobs/{{ job.id }}/edit"
               class="inline-flex items-center px-3 py-1 rounded bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium">
              Bearbeiten
            </a>
            <button type="button"
                    hx-confirm="Willst du diesen Job wirklich löschen?"
                    hx-delete="/htmx/jobs/{{ job.id }}"
                    hx-target="#jobs-list"
                    hx-swap="innerHTML"
                    class="inline-flex items-center px-3 py-1 rounded bg-red-600 hover:bg-red-700 text-white text-xs font-medium">
              Löschen
            </button>
          </div>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="7" class="text-center py-6 text-gray-400">Keine Jobs vorhanden</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
