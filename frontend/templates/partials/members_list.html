<!--
===============================================================================
Project   : gratulo
Module    : frontend/templates/partials/members_list.html
Created   : 2025-10-05
Author    : Florian
Purpose   : Dynamic template used to show the list of entities (formerly members)
===============================================================================
-->

{% set article_nom =
  'Neue' if LABELS_DISPLAY.entity_gender == 'f'
  else 'Neuer' if LABELS_DISPLAY.entity_gender == 'm'
  else 'Neues'
%}

{% set article_acc =
  'Neue' if LABELS_DISPLAY.entity_gender == 'f'
  else 'Neuen' if LABELS_DISPLAY.entity_gender == 'm'
  else 'Neues'
%}

<div id="members-list" class="bg-white shadow rounded-lg members-groups-container" style="height: 400px; display: flex; flex-direction: column;">
  <div class="flex justify-between items-center mb-4 px-4 pt-4" style="flex-shrink: 0;">
    <h2 class="text-xl font-bold text-gray-800">{{ LABELS_DISPLAY.entity_plural }}</h2>
    <a href="/members/new" class="btn btn-green">
      ➕ {{ article_acc }} {{ LABELS_DISPLAY.entity_singular }} anlegen
    </a>
  </div>

  <!-- Filterbereich -->
  <div class="flex items-center justify-between mb-4 px-4" style="flex-shrink: 0;">
    <div class="flex items-center gap-3">
      <label for="filter-deleted" class="text-sm text-gray-700 font-medium">Anzeigen:</label>
      <select id="filter-deleted"
              name="deleted"
              class="border rounded px-2 py-1 text-sm"
              hx-get="/htmx/members/list"
              hx-target="#members-list"
              hx-swap="outerHTML">
        <option value="false" {% if deleted == "false" %}selected{% endif %}>
          Aktive {{ LABELS_DISPLAY.entity_plural }}
        </option>
        <option value="true" {% if deleted == "true" %}selected{% endif %}>
          Deaktivierte {{ LABELS_DISPLAY.entity_plural }}
        </option>
        <option value="all" {% if deleted == "all" %}selected{% endif %}>
          Alle {{ LABELS_DISPLAY.entity_plural }}
        </option>
      </select>
    </div>
    <p class="text-xs text-gray-500 italic">
      Soft-Delete-Status kann über Aktionen geändert werden
    </p>
  </div>

  <!-- Entitätenliste mit Scroll -->
  <div style="flex: 1; overflow-y: auto; overflow-x: hidden; min-height: 0;">
    {% if members %}
    <table class="w-full divide-y divide-gray-200 table-fixed">
      <thead class="bg-gray-50 sticky top-0 z-10">
        <tr>
          <th class="px-3 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider bg-gray-50" style="width: 10%;">Vorname</th>
          <th class="px-3 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider bg-gray-50" style="width: 10%;">Nachname</th>
          <th class="px-3 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider bg-gray-50" style="width: 8%;">Geschlecht</th>
          <th class="px-3 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider bg-gray-50" style="width: 15%;">E-Mail</th>
          <th class="px-3 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider bg-gray-50" style="width: 9%;">{{ LABELS_DISPLAY.date1 }}</th>
          <th class="px-3 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider bg-gray-50" style="width: 7%;">{{ LABELS_DISPLAY.date2 }}</th>
          <th class="px-3 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider bg-gray-50" style="width: 10%;">Gruppe</th>
          <th class="px-3 py-3 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider bg-gray-50" style="width: 31%;">Aktionen</th>
        </tr>
      </thead>

      <tbody class="bg-white divide-y divide-gray-200 text-sm text-gray-700">
        {% for member in members %}
        <tr class="{% if member.is_deleted %}bg-gray-100 text-gray-400 italic{% else %}hover:bg-gray-50{% endif %}">
          <td class="px-3 py-3 font-medium text-gray-900 truncate">{{ member.firstname }}</td>
          <td class="px-3 py-3 truncate">{{ member.lastname }}</td>
          <td class="px-3 py-3">
            {% if member.gender == 'm' %}
              <span class="inline-flex items-center px-2 py-1 rounded-full bg-blue-100 text-blue-800 text-xs">Männlich</span>
            {% elif member.gender == 'w' %}
              <span class="inline-flex items-center px-2 py-1 rounded-full bg-pink-100 text-pink-800 text-xs">Weiblich</span>
            {% else %}
              <span class="inline-flex items-center px-2 py-1 rounded-full bg-gray-100 text-gray-600 text-xs">Divers</span>
            {% endif %}
          </td>
          <td class="px-6 py-4">{{ member.email }}</td>
          <td class="px-6 py-4">
            {% if member.birthdate %}
              {{ member.birthdate.strftime('%d.%m.%Y') }}
            {% endif %}
          </td>
          <td class="px-6 py-4">
            {{ member.member_since.year if member.member_since else '' }}
          </td>
          <td class="px-6 py-4">{{ member.group.name if member.group else '—' }}</td>

          <!-- Aktionen -->
          <td class="px-6 py-4 text-right">
            <div class="flex justify-end gap-2">
              {% if member.is_deleted %}
                <button type="button"
                        hx-post="/htmx/members/{{ member.id }}/restore"
                        hx-confirm="Soll {{ LABELS_DISPLAY.entity_singular }} wiederhergestellt werden?"
                        hx-target="#members-list"
                        hx-swap="outerHTML"
                        class="btn btn-green">
                  Wiederherstellen
                </button>

                <button type="button"
                        hx-delete="/htmx/members/{{ member.id }}/wipe?force=true"
                        hx-confirm="{{ LABELS_DISPLAY.entity_singular }} wird dauerhaft gelöscht! Fortfahren?"
                        hx-target="#members-list"
                        hx-swap="outerHTML"
                        class="btn btn-black">
                  Endgültig löschen
                </button>

              {% else %}
                <!-- Bearbeiten -->
                <a href="/members/{{ member.id }}/edit" class="btn btn-blue">
                  Bearbeiten
                </a>

                <button type="button"
                        hx-delete="/htmx/members/{{ member.id }}"
                        hx-confirm="{{ LABELS_DISPLAY.entity_singular }} deaktivieren?"
                        hx-target="#members-list"
                        hx-swap="outerHTML"
                        class="btn btn-red">
                  Deaktivieren
                </button>
              {% endif %}
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    {% else %}
    <div class="text-center py-10 text-gray-500">
      Noch keine {{ LABELS_DISPLAY.entity_plural }} vorhanden.
    </div>
    {% endif %}
  </div>
</div>
