{% set article_nom =
  'Neue' if LABELS_DISPLAY.entity_gender == 'f'
  else 'Neuer' if LABELS_DISPLAY.entity_gender == 'm'
  else 'Neues'
%}

{% set article_acc =
  'Neue' if LABELS_DISPLAY.entity_gender == 'f'
  else 'Neuen' if LABELS_DISPLAY.entity_gender == 'm'
  else 'Neues'
%}

<div id="members-list" class="bg-white shadow rounded-lg members-groups-container flex flex-col" style="height: calc(100vh - 650px); min-height: 300px;">

  <div class="flex flex-col md:flex-row justify-between items-center mb-4 px-4 pt-4 gap-4 flex-shrink-0">
    <h2 class="text-xl font-bold text-gray-800">{{ LABELS_DISPLAY.entity_plural }}</h2>

<form id="member-filters" class="flex items-center gap-2">

      <input type="hidden" name="order_by" value="{{ order_by }}">
      <input type="hidden" name="direction" value="{{ direction }}">

      <div class="relative">
        <input type="search"
               name="search"
               value="{{ search or '' }}"
               placeholder="Suchen..."
               class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm pl-8 py-2"
               hx-get="/htmx/members/list"
               hx-trigger="keyup changed delay:500ms, search"
               hx-target="#members-list"
               hx-swap="outerHTML"
               hx-include="closest form"
               autocomplete="off">
        <span class="absolute left-2.5 top-1/2 -translate-y-1/2 text-gray-400">
           <i class="fa-solid fa-search"></i>
        </span>
      </div>

      <div class="flex items-center gap-2">
        <select name="deleted"
                class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2"
                hx-get="/htmx/members/list"
                hx-trigger="change"
                hx-target="#members-list"
                hx-swap="outerHTML"
                hx-include="closest form">
          <option value="false" {% if deleted == "false" or not deleted %}selected{% endif %}>
            Aktive
          </option>
          <option value="true" {% if deleted == "true" %}selected{% endif %}>
            Deaktivierte / Papierkorb
          </option>
          <option value="all" {% if deleted == "all" %}selected{% endif %}>
            Alle anzeigen
          </option>
        </select>
      </div>
    </form>

    <a href="/members/new" class="btn btn-green whitespace-nowrap">
      ➕ {{ article_acc }} {{ LABELS_DISPLAY.entity_singular }} anlegen
    </a>
  </div>

  <div style="flex: 1; overflow-y: auto; overflow-x: hidden; min-height: 0; position: relative;" class="px-4 pb-4">

    {% if members %}
    <table class="w-full divide-y divide-gray-200 table-fixed">

    <thead class="bg-gray-50" style="position: sticky; top: 0; z-index: 20;">
      <tr>

        <th class="px-3 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap cursor-pointer hover:bg-gray-100"
            style="width:10%;"
            hx-get="/htmx/members/list?_no_confirm=1&order_by=firstname&direction={{ 'desc' if order_by == 'firstname' and direction == 'asc' else 'asc' }}"
            hx-include="#member-filters"
            hx-target="#members-list"
            hx-swap="outerHTML">
          <span style="white-space:nowrap;">
            Vorname
            {% if order_by == 'firstname' %}
              {{ ' ▲' if direction == 'asc' else ' ▼' }}
            {% else %}
              <span class="text-gray-300">⇅</span>
            {% endif %}
          </span>
        </th>

        <th class="px-3 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap cursor-pointer hover:bg-gray-100"
            style="width:10%;"
            hx-get="/htmx/members/list?_no_confirm=1&order_by=lastname&direction={{ 'desc' if order_by == 'lastname' and direction == 'asc' else 'asc' }}"
            hx-include="#member-filters"
            hx-target="#members-list"
            hx-swap="outerHTML">
          <span style="white-space:nowrap;">
            Nachname
            {% if order_by == 'lastname' %}
              {{ ' ▲' if direction == 'asc' else ' ▼' }}
            {% else %}
              <span class="text-gray-300">⇅</span>
            {% endif %}
          </span>
        </th>

        <th class="px-3 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap cursor-pointer hover:bg-gray-100"
            style="width:8%;"
            hx-get="/htmx/members/list?_no_confirm=1&order_by=gender&direction={{ 'desc' if order_by == 'gender' and direction == 'asc' else 'asc' }}"
            hx-include="#member-filters"
            hx-target="#members-list"
            hx-swap="outerHTML">
          <span style="white-space:nowrap;">
            Geschlecht
            {% if order_by == 'gender' %}
              {{ ' ▲' if direction == 'asc' else ' ▼' }}
            {% else %}
              <span class="text-gray-300">⇅</span>
            {% endif %}
          </span>
        </th>

        <th class="px-3 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap cursor-pointer hover:bg-gray-100"
            style="width:15%;"
            hx-get="/htmx/members/list?_no_confirm=1&order_by=email&direction={{ 'desc' if order_by == 'email' and direction == 'asc' else 'asc' }}"
            hx-include="#member-filters"
            hx-target="#members-list"
            hx-swap="outerHTML">
          <span style="white-space:nowrap;">
            E-Mail
            {% if order_by == 'email' %}
              {{ ' ▲' if direction == 'asc' else ' ▼' }}
            {% else %}
              <span class="text-gray-300">⇅</span>
            {% endif %}
          </span>
        </th>

        <th class="px-3 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap cursor-pointer hover:bg-gray-100"
            style="width:9%;"
            hx-get="/htmx/members/list?_no_confirm=1&order_by=birthdate&direction={{ 'desc' if order_by == 'birthdate' and direction == 'asc' else 'asc' }}"
            hx-include="#member-filters"
            hx-target="#members-list"
            hx-swap="outerHTML">
          <span style="white-space:nowrap;">
            {{ LABELS_DISPLAY.date1 }}
            {% if order_by == 'birthdate' %}
              {{ ' ▲' if direction == 'asc' else ' ▼' }}
            {% else %}
              <span class="text-gray-300">⇅</span>
            {% endif %}
          </span>
        </th>

        <th class="px-3 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap cursor-pointer hover:bg-gray-100"
            style="width:7%;"
            hx-get="/htmx/members/list?_no_confirm=1&order_by=member_since&direction={{ 'desc' if order_by == 'member_since' and direction == 'asc' else 'asc' }}"
            hx-include="#member-filters"
            hx-target="#members-list"
            hx-swap="outerHTML">
          <span style="white-space:nowrap;">
            {{ LABELS_DISPLAY.date2 }}
            {% if order_by == 'member_since' %}
              {{ ' ▲' if direction == 'asc' else ' ▼' }}
            {% else %}
              <span class="text-gray-300">⇅</span>
            {% endif %}
          </span>
        </th>

        <th class="px-3 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap cursor-pointer hover:bg-gray-100"
            style="width:10%;"
            hx-get="/htmx/members/list?_no_confirm=1&order_by=group_name&direction={{ 'desc' if order_by == 'group_name' and direction == 'asc' else 'asc' }}"
            hx-include="#member-filters"
            hx-target="#members-list"
            hx-swap="outerHTML">
          <span style="white-space:nowrap;">
            Gruppe
            {% if order_by == 'group_name' %}
              {{ ' ▲' if direction == 'asc' else ' ▼' }}
            {% else %}
              <span class="text-gray-300">⇅</span>
            {% endif %}
          </span>
        </th>

        <th class="px-3 py-3 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap"
            style="width:31%;">
          Aktionen
        </th>

      </tr>
    </thead>

      <tbody class="bg-white divide-y divide-gray-200 text-sm text-gray-700">
        {% for member in members %}
        <tr class="{% if member.is_deleted %}bg-gray-100 text-gray-400 italic{% else %}hover:bg-gray-50{% endif %}">
          <td class="px-3 py-2 font-medium text-gray-900 truncate">{{ member.firstname }}</td>
          <td class="px-3 py-2 truncate">{{ member.lastname }}</td>
          <td class="px-3 py-2">
            {% if member.gender == 'm' %}
              <span class="inline-flex items-center px-2 py-1 rounded-full bg-blue-100 text-blue-800 text-xs">Männlich</span>
            {% elif member.gender == 'w' %}
              <span class="inline-flex items-center px-2 py-1 rounded-full bg-pink-100 text-pink-800 text-xs">Weiblich</span>
            {% else %}
              <span class="inline-flex items-center px-2 py-1 rounded-full bg-gray-100 text-gray-600 text-xs">Divers</span>
            {% endif %}
          </td>
          <td class="px-3 py-2">{{ member.email }}</td>
          <td class="px-3 py-2">
            {% if member.birthdate %}
              {{ member.birthdate.strftime('%d.%m.%Y') }}
            {% endif %}
          </td>
          <td class="px-3 py-2">
            {{ member.member_since.year if member.member_since else '' }}
          </td>
          <td class="px-3 py-2">{{ member.group.name if member.group else '—' }}</td>

          <td class="px-3 py-2 text-right">
            <div class="flex justify-end gap-2">
              {% if member.is_deleted %}

                <button type="button"
                        hx-post="/htmx/members/{{ member.id }}/restore"
                        hx-confirm="Soll {{ LABELS_DISPLAY.entity_singular }} wiederhergestellt werden?"
                        hx-include="#member-filters"
                        hx-target="#members-list"
                        hx-swap="outerHTML"
                        class="btn btn-green">
                  Wiederherstellen
                </button>

                <button type="button"
                        hx-delete="/htmx/members/{{ member.id }}/wipe?force=true"
                        hx-confirm="{{ LABELS_DISPLAY.entity_singular }} wird dauerhaft gelöscht! Fortfahren?"
                        hx-include="#member-filters"  hx-target="#members-list"
                        hx-target="#members-list"
                        hx-swap="outerHTML"
                        class="btn btn-black">
                  Endgültig löschen
                </button>

              {% else %}
                <a href="/members/{{ member.id }}/edit" class="btn btn-blue">
                  Bearbeiten
                </a>

                <button type="button"
                        hx-delete="/htmx/members/{{ member.id }}"
                        hx-confirm="{{ LABELS_DISPLAY.entity_singular }} deaktivieren?"
                        hx-include="#member-filters"
                        hx-target="#members-list"
                        hx-swap="outerHTML"
                        class="btn btn-red">
                  Deaktivieren
                </button>
              {% endif %}
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    {% else %}
    <div class="text-center py-10 text-gray-500">
      Noch keine {{ LABELS_DISPLAY.entity_plural }} vorhanden (oder keine Treffer für die Suche).
    </div>
    {% endif %}
  </div>
</div>